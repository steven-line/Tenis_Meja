{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking</title>
    <link rel="icon" href="{% static 'website/images/icon.jpg' %}">
    <link rel="stylesheet" href="{% static 'website/style.css' %}">
</head>
<body>
    <header>
        <div class="logo">Ping Pong Community</div>
        <nav>
            <ul>
                <li><a href="{% url 'home' %}">Home</a></li>
                <li class="dropdown">
                    <a href="#" class="dropbtn">Schedule</a>
                    <div class="dropdown-content">
                        <a href="{% url 'tournament_schedule' %}">Tournament Schedule</a>
                        <a href="{% url 'training_schedule' %}">Training Schedule</a>
                    </div>
                </li>
                <li><a href="{% url 'ranking' %}">Ranking</a></li>
                <li><a href="{% url 'documentation' %}">Documentation</a></li>
                <li><a href="{% url 'forum' %}">Forum</a></li>
                <li><a href="{% url 'login' %}">Login</a></li>
                {% if user.is_authenticated %}
                <li><a href="{% url 'upload' %}">Upload</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    {% if user.is_authenticated %}
    <div class="profile">
        <span>Hi, {{ user.username }}</span>
        <a href="{% url 'profile' %}">Profile</a>
        <a href="{% url 'logout' %}">Logout</a>
    </div>
    {% endif %}

    <main>
        <h1 class="page-title">Leaderboard</h1>

        <table class="leaderboard fade-in">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Player Name</th>
                    <th>Points</th>
                    <th>City</th> 
                    <th>Rank Change</th>
                </tr>
            </thead>
            <tbody>
                {% for player in players %}
                <tr>
                    <td>{{ player.rank }}</td>
                    <td>{{ player.name }}</td>
                    <td>{{ player.points }}</td>
                    <td>{{ player.city }}</td> 
                    <td>
                        {% if player.rank_change %}
                            {% if player.rank_change|slice:":1" == "▲" %}
                                <span class="rank-change-up">{{ player.rank_change }}</span> 
                            {% elif player.rank_change|slice:":1" == "▼" %}
                                <span class="rank-change-down">{{ player.rank_change }}</span>  
                            {% else %}
                                {{ player.rank_change }} 
                            {% endif %}
                        {% else %}
                            {{ player.rank_change }} 
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>        

        <h3>Ranking Change History</h3>

        <!-- Tabel History -->
        <table class="ranking-history">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Points Before</th>
                    <th>Points Added</th>
                    <th>Points After</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for history in ranking_history %}
                <tr>
                    <td>{{ history.player.name }}</td>
                    <td>{{ history.points_before }}</td>
                    <td>{{ history.points_after|subtract:history.points_before }}</td>
                    <td>{{ history.points_after }}</td>
                    <td>{{ history.changed_at|date:"Y-m-d H:i" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">No ranking history available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>                
                                        

        <a href="{% url 'ranking_details' %}" class="details-btn">View Details</a>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-section">
                <h4>About Us</h4>
                <p>Ping Pong Community bertujuan untuk membangun hubungan yang baik antar anggota.</p>
            </div>
            <div class="footer-section">
                <h4>Our Training Location</h4>
                <div class="maps-container">
                    <!-- Embed Google Maps -->
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3958.156287455074!2d112.7920167!3d-7.260711!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dd7f9f6cec3c03d%3A0xf8798c0f7c0b11f5!2sUniversitas%20Widya%20Kartika!5e0!3m2!1sen!2sid!4v1695235297654!5m2!1sen!2sid" 
                        width="100%" 
                        height="200" 
                        style="border:0;" 
                        allowfullscreen="" 
                        loading="lazy" 
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
            <div class="footer-section">
                <h4>Contact Us</h4>
                <p>Email: <a href="mailto:info@pingpongcommunity.com">info@pingpongcommunity.com</a></p>
                <p>Instagram: <a href="https://instagram.com/pingpongcommunity" target="_blank">@pingpongcommunity</a></p>
                <p>Facebook: <a href="https://facebook.com/pingpongcommunity" target="_blank">Ping Pong Community</a></p>
                <p>Phone: +62 813-3423-8083</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Ping Pong Community. All rights reserved.</p>
        </div>
    </footer>
    
</body>
</html>
